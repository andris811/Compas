<div class="container">
  <div class="grid grid-cols-2">
    <div class="w-full mr-14 rounded relative" style="background-image: url(<%= @trip.trip_img %>); background-size: cover;">
      <div class="content-end" style="background-image: linear-gradient(to left, rgba(0,0,0,0.2), rgba(0,0,0,.3));">
        <div class="h-96"></div>
        <%# tags %>
        <div class="absolute right-2 bottom-2">
          <% @trip.activities.each do |tag|  %>
            <h2 class="rounded-md px-2 text-center bg-darkblue mt-2 text-sm text-white font-md"> <%= tag %> </h2>
          <% end %>
        </div>
        <%# apply/cancel button %>
      <div class="absolute left-2 bottom-0 mb-2">
       <h2 class="text-white text-2xl ml-2 mb-2">
              <%= @trip.trip_name.capitalize %> in <%= @trip.country.capitalize %>
            </h2>
        <% list = [] %>
          <% @trip.attendees.each do |attendee| %>
            <% list << attendee.user_id %>
          <% end %>
        <%# check if already attending %>
        <% if (user_signed_in?) then %>
          <% current_user_attendee_id = "" %>
          <%# cancel attendance button %>
          <% if list.include?(current_user.id) %>
            <% @trip.attendees.each do |attendee| %>
              <% if attendee.user_id == current_user.id %>
                <% current_user_attendee_id = attendee.id %>
              <% end %>
            <% end %>
            <%= button_to "/trips/#{@trip.id}/attendees/#{current_user_attendee_id}", confirm: "Are you sure?", method: :delete do %>
              <p class="bg-yellow py-2 px-8 ml-4 rounded-2xl shadow-md active:shadow-lg transition duration-150 ease-in-out uppercase text-darkblue text-md cursor-pointer" ><strong>Cancel</strong></p>
            <% end %>
            <%# if you're organizer, doesn't show the apply button %>
          <% elsif current_user.id == @trip.organizer.id %>
            <%# apply button for attendees %>
          <% else %>
            <%= button_to [@trip, :attendees] do %>
              <p class="bg-yellow py-2 px-8 ml-4 rounded-2xl shadow-md active:shadow-lg transition duration-150 ease-in-out uppercase text-darkblue text-md cursor-pointer" ><strong>Apply</strong></p>
            <% end %>
          <% end %>
        <% end %>

          <%# If organizer, then can edit the trip %>
            <% if current_user.id == @trip.organizer.id %>
              <%= link_to edit_trip_path do %>
                <button class="bg-yellow py-2 px-2 ml-2 mb-2 text-sm text-white rounded-2xl font-bold uppercase hover:bg-darkblue">EDIT TRIP<i class="fa-solid fa-pen-to-square text-base text-white ml-2"></i></button>
              <% end %>
            <% end %>


      </div>
      <%# Bottom half of the page %>
        <%# make a list of attendees by id %>
    </div>
    </div>

    <div class="grid grid-cols-2 ml-4 gap-4">
      <% @trip.photos.each do |photo| %>
        <%= cl_image_tag photo.key, height: 300, width: 400, crop: :fill %>
      <% end %>
    </div>
  </div>
  <div class="rounded-2xl mt-6">
    <div class="flex">
      <h3 class="ml-4 text-gray-500 text-base mr-10"> <%= @trip.start_date %> - <%= @trip.end_date %>  </h3>
      <h6 class= "text-sm mr-4">Are pets allowed?</h6>
      <% if @trip.pets == true  %>
        <i class="fa-solid fa-dog"></i>
        <% else %>
        <i class="fa-sharp fa-solid fa-ban"></i>
      <% end %>
    </div>
    <h1 class="ml-4 text-darkblue mr-10 text-3xl mt-2"><%= @trip.trip_name.capitalize %> in <%= @trip.country.capitalize %></h1>
    <div class="flex pb-8 ml-4">
      <%# left %>
      <div class="mr-24 w-1/2">
        <%# description and comment tabs %>
        <div class="tabs">
          <input type="radio" class="tabs__radio" name="tab-" id="tab1" checked>
          <label for="tab1" class="tabs__label mt-2 mr-8 text-base text-gray-500 hover:text-darkblue">About</label>
          <div class="tabs__content">
            <%# <h2 class="mt-2 text-3xl"><%= @trip.trip_name.capitalize %></h2>
            <h3 class="mt-2 text-base text-darkblue font-md"><%= @trip.description.capitalize %></h3>
          </div>
          <input type="radio" class="tabs__radio" name="tab-" id="tab2" >
          <label for="tab2" class="tabs__label mt-2 text-base text-gray-500 hover:text-darkblue">Comment</label>
          <div class="tabs__content">
            <% if (user_signed_in?) then %>
              <h2 class="mt-2 text-xl mb-2"> <%= current_user.first_name.capitalize %> <%= current_user.last_name.capitalize %> </h2>
              <%= simple_form_for [@trip, @message] do |f| %>
                <div>
                  <%= f.input :comment, :as => :text, label: false, input_html: { class:"w-full h-40 border-transparent drop-shadow" } %>
                </div>
                <div>
                  <%= f.button :submit, :value => "Send", class: "ml-96 mt-px btn px-4 py-2 bg-yellow text-darkblue font-bold text-sm font-bold leading-tight uppercase rounded shadow-md" %>
                </div>
              <% end %>
              <div class= "shadow-lg border-2 rounded-xl mt-2">
                <% @trip.messages.each do |message| %>
                  <h3 class="text-sm mx-4 "><%= message.user.first_name.capitalize %></h3>
                  <div class="flex">
                    <img class="ml-4 mt-1 h-10 w-10" src="<%= message.user.avatar %> " alt="">
                    <h3 class="text-xs mx-6  my-4" ><%= message.comment %></h3>
                  </div>
                <% end %>
              </div>
            <% else %>
              You need to log in to see the comments
            <% end %>
          </div>
        </div>
      </div>
      <%# right side of page%>
      <div class="ml-24 mb-2 w-1/2 h-full">
        <h3 class="text-base">Organized by:</h3>
          <div class="flex mb-14 mt-4">
            <%= link_to user_path(@trip.organizer.id) do %>
              <div class="flex flex-row">
                <img src= <%= @trip.organizer.avatar %> class="rounded-full"  style="height: 64px; width: 64px; border-color: #eeba0b; border-width: medium;" alt="" loading="lazy"  />
                <h3 class="ml-2 mt-3 text-lg"><%= @trip.organizer.first_name.capitalize %> <%= @trip.organizer.last_name.capitalize %></h3>
              </div>
            <% end %>
          </div>
          <%# attendee box %>
        <div class="flex">
        <h3 class="text-base mt-4 mr-4">Attendees:</h3>
        <h3 class="text-base mt-4 ml-4"> <%= @trip.attendees.count +1 %> / <%= @trip.max_people %></h3>
        </div>
        <%# If signed in %>
        <% if (user_signed_in?) then %>
          <%# If organizer %>
          <% if current_user.id == @trip.organizer.id then %>
            <%# tabs %>
            <div class="tabs shadow-md rounded-lg mt-2">
              <input type="radio" class="tabs__radio" name="tab-2" id="tab3" checked>
              <label for="tab3" class="tabs__label m-2 text-gray-500 hover:text-darkblue">Requests</label>
              <div class="ml-2 tabs__content">

                <%# List attendees requesting %>
                <div class="p-2">
                  <% @trip.attendees.each do |attendee| %>
                    <% if attendee.approved == false %>
                      <div class="grid grid-cols-3  ">
                        <%= link_to user_path(attendee.user.id) do %>
                          <div>
                            <img src=<%= attendee.user.avatar %> class="rounded-full"  style="height: 64px; width: 64px; " alt="" loading="lazy"  />
                            <%= attendee.user.first_name %>
                            <%= attendee.user.last_name %>
                          </div>
                        <% end %>
                        <div>
                          <%= button_to trip_attendee_path(attendee.id), method: :patch do %>
                            <p class="bg-yellow py-2 px-5 rounded-2xl cursor-pointer" ><strong>Approve</strong></p>
                          <% end %>
                          <%# <a href="" class="bg-yellow py-2 px-4 rounded-2xl ">Accept</a> %>
                        </div>
                        <div>
                          <%= button_to trip_attendee_path(attendee.id), method: :delete do %>
                            <p class="bg-yellow py-2 px-8 rounded-2xl  cursor-pointer" ><strong>Reject</strong></p>
                          <% end %>
                          <%# <a href="" class="bg-yellow py-2 px-4 rounded-2xl ">Accept</a> %>
                        </div>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
              <%# list attendees confirmed %>
              <input type="radio" class="tabs__radio" name="tab-2" id="tab4" >
              <label for="tab4" class="tabs__label m-2 text-gray-500 hover:text-darkblue">Confirmed</label>
              <div class="ml-2 tabs__content">
                <%# list all confirmed %>
                <div class="grid grid-cols-3 p-2">
                  <% @trip.attendees.each do |attendee| %>
                    <% if attendee.approved == true %>
                      <div class="">
                        <a href=""><img src=<%= attendee.user.avatar %> class="rounded-full"  style="height: 64px; width: 64px; " alt="" loading="lazy"  /></a>
                      </div>
                      <div class="">
                        <%= attendee.user.first_name %>
                        <%= attendee.user.last_name %>
                      </div>
                      <div class="align-middle">
                        <%# <a href="" class="bg-yellow py-2 px-4 rounded-2xl ">Remove</a> %>
                          <%= button_to trip_attendee_path(attendee.id), method: :patch do %>
                            <p class="bg-yellow py-2 px-8 rounded-2xl  cursor-pointer" ><strong>Remove</strong></p>
                          <% end %>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
            <%# if not the organizer %>
          <% else %>
            <div>
              <% if @trip.attendees.count == 0 %>
                <h2 class="text-base mt-4"> Be the first to sign-up! </h2>

              <% elsif @trip.attendees.count == 1  %>
                <h2 class="text-base mt-4"> <%= @trip.attendees.count %> person is going </h2>

              <% elsif @trip.attendees.count >= 2 %>
                <h2 class="text-base mt-4"> <%= @trip.attendees.count %> other people are going </h2>
              <% end %>
            </div>

              <div class="flex mt-4 gap-x-4">
                <% @trip.attendees.each do |attendee| %>
                  <%= link_to user_path(attendee.user.id) do %>
                    <div>
                      <img src=<%= attendee.user.avatar %> class="rounded-full"  style="height: 64px; width: 64px; " alt="" loading="lazy"  />
                      <%= attendee.user.first_name %>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
          <%# If not signed in %>
        <% else %>
          <div>

            <% if @trip.attendees.count-1 == 0  %>
              <h2 class="text-base mt-4"> Be the first to sign-up! </h2>

            <% elsif @trip.attendees.count == 1  %>
              <h2 class="text-base mt-4"> <%= @trip.attendees.count %> person is going </h2>

            <% elsif @trip.attendees.count >= 2 %>
              <h2 class="text-base mt-4"> <%= @trip.attendees.count %> other people are going </h2>
            <% end %>
            </div>

        <% end %>
      </div>
    </div>

  </div>
</div>
